((e,t)=>{typeof exports=="object"&&typeof module!="undefined"?t(exports):typeof define=="function"&&define.amd?define(["exports"],t):t((e=typeof globalThis!="undefined"?globalThis:e||self).idb={})})(this,e=>{let t,n;const r=new WeakMap,o=new WeakMap,s=new WeakMap,a=new WeakMap,i=new WeakMap;const c=e=>{const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("success",s),e.removeEventListener("error",a)},s=()=>{t(l(e.result)),r()},a=()=>{n(e.error),r()};e.addEventListener("success",s),e.addEventListener("error",a)});return t.then(t=>{t&&t.constructor.name==="IDBCursor"&&r.set(t,e)}),t},u=e=>s.get(e);const d=e=>{const t=e.transaction;t&&s.set(e,t);const n=[...e.objectStoreNames];return n.length>0?Promise.all(n.map(n=>e.get(n))):Promise.resolve([])};const l=e=>{if(e instanceof IDBDatabase)return n||(n=new Proxy(e,{get:(e,t)=>"get"===t?n=>e.get(n):"close"===t?()=>e.close():"transaction"===t?(...n)=>new Proxy(e.transaction(...n),{get:(e,t)=>"get"===t?t=>e.get(t):"objectStore"===t?(...t)=>new Proxy(e.objectStore(...t),{get:(e,t)=>"get"===t?t=>e.get(t):"openCursor"===t?(...t)=>e.openCursor(...t):"openKeyCursor"===t?(...t)=>e.openKeyCursor(...t):e[t].bind(e)}):e[t].bind(e)}):e[t].bind(e)})),n;if(e instanceof IDBTransaction)return t||(t=new Proxy(e,{get:(e,t)=>"get"===t?t=>e.get(t):"objectStore"===t?(...t)=>new Proxy(e.objectStore(...t),{get:(e,t)=>"get"===t?t=>e.get(t):"openCursor"===t?(...t)=>e.openCursor(...t):"openKeyCursor"===t?(...t)=>e.openKeyCursor(...t):e[t].bind(e)}):e[t].bind(e)})),t;if(e instanceof IDBCursor)return o.get(e)||o.set(e,new Proxy(e,{get:(e,t)=>"continue"===t?t=>e.continue(t):"continuePrimaryKey"===t?(...t)=>e.continuePrimaryKey(...t):"advance"===t?t=>e.advance(t):e[t].bind(e)})),o.get(e);if(e instanceof IDBRequest)return c(e);if(e instanceof IDBObjectStore)return a.get(e)||a.set(e,new Proxy(e,{get:(e,t)=>"get"===t?t=>e.get(t):"openCursor"===t?(...t)=>e.openCursor(...t):"openKeyCursor"===t?(...t)=>e.openKeyCursor(...t):e[t].bind(e)})),a.get(e);if(e instanceof IDBIndex)return i.get(e)||i.set(e,new Proxy(e,{get:(e,t)=>"get"===t?t=>e.get(t):"openCursor"===t?(...t)=>e.openCursor(...t):"openKeyCursor"===t?(...t)=>e.openKeyCursor(...t):e[t].bind(e)})),i.get(e);const s=r.get(e);return s?l(s):e};e.openDB=function(e,t,{blocked:n,upgrade:r,blocking:o,terminated:s}={}){const a=indexedDB.open(e,t),i=l(a);return a.onupgradeneeded=e=>{r&&r(l(a.result),e.oldVersion,e.newVersion,l(a.transaction))},n&&i.addEventListener("blocked",()=>n()),o&&i.addEventListener("versionchange",()=>o()),s&&i.addEventListener("close",()=>s()),i},e.deleteDB=function(e,{blocked:t}={}){const n=indexedDB.deleteDatabase(e);return t&&l(n).addEventListener("blocked",()=>t()),l(n).then(()=>)},e.unwrap=e=>r.get(e)||e,e.wrap=l});
//# sourceMappingURL=umd.js.map